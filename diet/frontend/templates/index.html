<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriAI - Obesity Prediction Tool</title>
    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../static/style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <img src="../static/nutri-logo.png" alt="NutriAI Logo" height="50" class="d-inline-block align-top">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="/"><i class="fas fa-weight-scale me-1"></i>Obesity Prediction</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/meal-planner"><i class="fas fa-utensils me-1"></i>Meal Planner</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#about"><i class="fas fa-info-circle me-1"></i>About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contact"><i class="fas fa-envelope me-1"></i>Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container my-4">
        <!-- Header Section -->
        <div class="page-header text-center py-5 mb-5">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <h1 class="display-4 fw-bold mb-3">Obesity Prediction</h1>
                    <p class="lead">Use our advanced AI tool to predict your obesity level based on lifestyle and habits. Fill in the form below to get personalized insights.</p>
                </div>
            </div>
        </div>

        <!-- Information Cards -->
        <div class="row mb-5">
            <div class="col-md-4 mb-4">
                <div class="info-card card h-100">
                    <div class="card-body text-center">
                        <div class="info-card-icon mx-auto">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <h5 class="card-title">Health Assessment</h5>
                        <p class="card-text">Our AI model analyzes your health metrics and lifestyle to provide accurate obesity predictions.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="info-card card h-100">
                    <div class="card-body text-center">
                        <div class="info-card-icon mx-auto">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h5 class="card-title">Advanced Analytics</h5>
                        <p class="card-text">Powered by machine learning algorithms trained on comprehensive health and lifestyle data.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="info-card card h-100">
                    <div class="card-body text-center">
                        <div class="info-card-icon mx-auto">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <h5 class="card-title">Personalized Insights</h5>
                        <p class="card-text">Get personalized predictions based on your unique physical characteristics and habits.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Card -->
        <div class="form-section">
            <form id="predictionForm" class="needs-validation" novalidate>
                <!-- Personal Information -->
                <div class="section-title">
                    <h4><i class="fas fa-user me-2"></i>Personal Information</h4>
                </div>
                <div class="row mb-4">
                    <div class="col-md-3 mb-3">
                        <label for="gender" class="form-label">Gender</label>
                        <select class="form-select" id="gender" required>
                            <option value="">Choose...</option>
                            <option value="0">Male</option>
                            <option value="1">Female</option>
                        </select>
                        <div class="invalid-feedback">Please select your gender.</div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="age" class="form-label">Age</label>
                        <input type="number" class="form-control" id="age" min="1" required>
                        <div class="invalid-feedback">Please enter your age.</div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="height" class="form-label">Height (meters)</label>
                        <input type="number" step="0.01" class="form-control" id="height" min="0.5" max="2.5" required>
                        <div class="invalid-feedback">Please enter a valid height (0.5-2.5m).</div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="weight" class="form-label">Weight (kg)</label>
                        <input type="number" step="0.1" class="form-control" id="weight" min="20" required>
                        <div class="invalid-feedback">Please enter a valid weight.</div>
                    </div>
                </div>

                <!-- Diet & Health History -->
                <div class="section-title">
                    <h4><i class="fas fa-utensils me-2"></i>Diet & Health History</h4>
                </div>
                <div class="row mb-4">
                    <div class="col-md-4 mb-3">
                        <label for="family_history_with_overweight" class="form-label">Family History with Overweight</label>
                        <select class="form-select" id="family_history_with_overweight" required>
                            <option value="">Choose...</option>
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                        <div class="invalid-feedback">Please make a selection.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="favc" class="form-label">Frequent Consumption of High-Caloric Food</label>
                        <select class="form-select" id="favc" required>
                            <option value="">Choose...</option>
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                        <div class="invalid-feedback">Please make a selection.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="fcvc" class="form-label">Frequency of Vegetable Consumption (1-3)</label>
                        <input type="number" class="form-control" id="fcvc" min="1" max="3" required>
                        <div class="invalid-feedback">Please enter a value between 1-3.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="ncp" class="form-label">Number of Main Meals (1-4)</label>
                        <input type="number" class="form-control" id="ncp" min="1" max="4" required>
                        <div class="invalid-feedback">Please enter a value between 1-4.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="caec" class="form-label">Consumption of Food Between Meals</label>
                        <select class="form-select" id="caec" required>
                            <option value="">Choose...</option>
                            <option value="1">No</option>
                            <option value="2">Sometimes</option>
                            <option value="3">Frequently</option>
                            <option value="4">Always</option>
                        </select>
                        <div class="invalid-feedback">Please make a selection.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="smoke" class="form-label">Do You Smoke?</label>
                        <select class="form-select" id="smoke" required>
                            <option value="">Choose...</option>
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                        <div class="invalid-feedback">Please make a selection.</div>
                    </div>
                </div>

                <!-- Lifestyle & Habits -->
                <div class="section-title">
                    <h4><i class="fas fa-heartbeat me-2"></i>Lifestyle & Habits</h4>
                </div>
                <div class="row mb-4">
                    <div class="col-md-4 mb-3">
                        <label for="ch2o" class="form-label">Daily Water Intake (1-3)</label>
                        <input type="number" class="form-control" id="ch2o" min="1" max="3" required>
                        <div class="invalid-feedback">Please enter a value between 1-3.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="scc" class="form-label">Calories Consumption Monitoring</label>
                        <select class="form-select" id="scc" required>
                            <option value="">Choose...</option>
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                        <div class="invalid-feedback">Please make a selection.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="faf" class="form-label">Physical Activity Frequency (0-3)</label>
                        <input type="number" class="form-control" id="faf" min="0" max="3" required>
                        <div class="invalid-feedback">Please enter a value between 0-3.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="tue" class="form-label">Time Using Technology Devices (0-2)</label>
                        <input type="number" class="form-control" id="tue" min="0" max="2" required>
                        <div class="invalid-feedback">Please enter a value between 0-2.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="calc" class="form-label">Consumption of Alcohol</label>
                        <select class="form-select" id="calc" required>
                            <option value="">Choose...</option>
                            <option value="3">Always</option>
                            <option value="2">Frequently</option>
                            <option value="1">Sometimes</option>
                            <option value="0">No</option>
                        </select>
                        <div class="invalid-feedback">Please make a selection.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="mtrans" class="form-label">Transportation Mode</label>
                        <select class="form-select" id="mtrans" required>
                            <option value="">Choose...</option>
                            <option value="0">Automobile, Motorbike</option>
                            <option value="1">Public Transportation, Walking</option>
                        </select>
                        <div class="invalid-feedback">Please make a selection.</div>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary btn-lg px-5">
                        <i class="fas fa-calculator me-2"></i>Get Prediction
                    </button>
                </div>
            </form>
        </div>

        <!-- Results Section -->
        <div id="result" class="result-container text-center" style="display: none;">
            <div class="spinner-border text-primary mb-3" role="status" id="loadingSpinner">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div id="resultContent"></div>
        </div>
    </div>

    <!-- About Section -->
    <div class="container my-5" id="about">
        <div class="row">
            <div class="col-12 text-center mb-4">
                <h2 class="fw-bold section-title d-inline-block pb-2">About NutriAI</h2>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card info-card h-100">
                    <div class="card-body">
                        <h3 class="card-title mb-4">Our Technology</h3>
                        <p class="card-text">
                            NutriAI uses advanced machine learning algorithms to predict obesity levels based on various lifestyle factors. 
                            Our model is trained on comprehensive datasets and provides accurate predictions to help you understand your health better.
                        </p>
                        <p class="card-text">
                            The prediction system analyzes factors such as eating habits, physical activity, water intake, and other lifestyle choices
                            to determine potential obesity risks.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card info-card h-100">
                    <div class="card-body">
                        <h3 class="card-title mb-4">How It Helps</h3>
                        <p class="card-text">
                            Understanding your obesity risk can help you take proactive steps toward a healthier lifestyle. 
                            Our prediction tool is designed to give you insights about how different aspects of your life might be 
                            affecting your health.
                        </p>
                        <p class="card-text">
                            While this tool provides predictions based on statistical models, we always recommend consulting with healthcare 
                            professionals for personalized health advice.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer id="contact">
        <div class="container py-4">
            <div class="row">
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5>About NutriAI</h5>
                    <p class="text-muted">NutriAI uses advanced machine learning to help you understand obesity risk factors and make informed lifestyle choices for better health outcomes.</p>
                </div>
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="#"><i class="fas fa-chevron-right me-2"></i>Home</a></li>
                        <li><a href="#about"><i class="fas fa-chevron-right me-2"></i>About</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right me-2"></i>Privacy Policy</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right me-2"></i>Terms of Service</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Contact Us</h5>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-envelope me-2"></i>contact@nutriai.com</li>
                        <li><i class="fas fa-phone me-2"></i>(123) 456-7890</li>
                        <li><i class="fas fa-map-marker-alt me-2"></i>123 Health St, Wellness City</li>
                        <li class="mt-3">
                            <a href="#" class="me-2"><i class="fab fa-facebook fa-lg"></i></a>
                            <a href="#" class="me-2"><i class="fab fa-twitter fa-lg"></i></a>
                            <a href="#" class="me-2"><i class="fab fa-instagram fa-lg"></i></a>
                            <a href="#" class="me-2"><i class="fab fa-linkedin fa-lg"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
            <hr class="mt-4 border-light opacity-25">
            <div class="text-center">
                <p class="mb-0">&copy; 2023 NutriAI. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Form Scripts -->
    <script>
        // Form validation
        (() => {
            'use strict'
            const forms = document.querySelectorAll('.needs-validation')
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }
                    form.classList.add('was-validated')
                }, false)
            })
        })()

        // Handle form submission
        document.getElementById('predictionForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            // Show loading state
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            document.getElementById('loadingSpinner').style.display = 'inline-block';
            document.getElementById('resultContent').innerHTML = '';

            // Scroll to results
            resultDiv.scrollIntoView({ behavior: 'smooth' });

            // Calculate BMI properly
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const bmi = weight / (height * height);

            // Create form data exactly matching the DataFrame columns and order from the model training
            const formData = {
                // Ensure data is in the same order as the original training dataframe
                Gender: parseInt(document.getElementById('gender').value),
                Age: parseFloat(document.getElementById('age').value),
                Height: parseFloat(document.getElementById('height').value),
                Weight: parseFloat(document.getElementById('weight').value),
                family_history_with_overweight: parseInt(document.getElementById('family_history_with_overweight').value),
                FAVC: parseInt(document.getElementById('favc').value),
                FCVC: parseFloat(document.getElementById('fcvc').value),
                NCP: parseFloat(document.getElementById('ncp').value),
                CAEC: parseInt(document.getElementById('caec').value),
                SMOKE: parseInt(document.getElementById('smoke').value),
                CH2O: parseFloat(document.getElementById('ch2o').value),
                SCC: parseInt(document.getElementById('scc').value),
                FAF: parseFloat(document.getElementById('faf').value),
                TUE: parseFloat(document.getElementById('tue').value),
                CALC: parseInt(document.getElementById('calc').value),
                MTRANS: parseInt(document.getElementById('mtrans').value),
                BMI: bmi
            };

            console.log('Form Data:', formData); // Log form data for debugging

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                // Hide loading spinner
                document.getElementById('loadingSpinner').style.display = 'none';

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Error Response:', errorData);
                    document.getElementById('resultContent').innerHTML = `
                        <div class="alert alert-danger fade-in" role="alert">
                            <h4 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Error</h4>
                            <p>${errorData.error}</p>
                        </div>`;
                    return;
                }

                const result = await response.json();
                
                // Get description based on prediction
                const descriptions = {
                    "Insufficient_Weight": "Your BMI and lifestyle factors indicate you may be underweight. Consider consulting with a nutritionist for a balanced diet plan.",
                    "Normal_Weight": "You have a healthy weight according to your BMI and lifestyle factors. Keep maintaining your healthy habits!",
                    "Overweight_Level_I": "You show some signs of being slightly overweight. Consider increasing physical activity and watching your diet.",
                    "Overweight_Level_II": "You're showing moderate signs of being overweight. Increasing exercise and improving dietary habits is recommended.",
                    "Obesity_Type_I": "Your profile indicates mild obesity. A structured diet and regular exercise plan would be beneficial.",
                    "Obesity_Type_II": "Your profile indicates moderate obesity. Consider consulting with healthcare providers for a weight management plan.",
                    "Obesity_Type_III": "Your profile indicates severe obesity. We strongly recommend consulting with healthcare professionals for a comprehensive plan."
                };
                
                const description = descriptions[result.prediction] || "Based on your inputs, we recommend consulting with a healthcare professional for personalized advice.";
                
                document.getElementById('resultContent').innerHTML = `
                    <div class="alert alert-success fade-in" role="alert">
                        <h4 class="alert-heading"><i class="fas fa-check-circle me-2"></i>Result</h4>
                        <p class="display-6 mt-3">Predicted Obesity Level:</p>
                        <p class="display-5 fw-bold mb-4">${result.prediction.replace(/_/g, ' ')}</p>
                        <hr>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-3 border-0 bg-transparent">
                                    <div class="card-body">
                                        <h5 class="text-start">Your BMI: ${bmi.toFixed(2)}</h5>
                                        <div class="progress mt-2">
                                            <div class="progress-bar bg-${getBMIColorClass(bmi)}" role="progressbar" 
                                                style="width: ${Math.min(bmi, 40) * 2.5}%" 
                                                aria-valuenow="${bmi}" aria-valuemin="0" aria-valuemax="40">
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-between mt-1">
                                            <small>Underweight</small>
                                            <small>Normal</small>
                                            <small>Overweight</small>
                                            <small>Obese</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 text-start">
                                <p class="mb-0"><strong>Recommendation:</strong> ${description}</p>
                            </div>
                        </div>
                    </div>`;
            } catch (error) {
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('resultContent').innerHTML = `
                    <div class="alert alert-danger fade-in" role="alert">
                        <h4 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Error</h4>
                        <p>${error.message}</p>
                    </div>`;
            }
        });
        
        // Helper function to determine BMI color class
        function getBMIColorClass(bmi) {
            if (bmi < 18.5) return "info";
            if (bmi < 25) return "success";
            if (bmi < 30) return "warning";
            return "danger";
        }
    </script>
</body>
</html>